<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free, read-frendly and open-source book on ZF3">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Acción de controlador y carga de archivos &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free, read-frendly and open-source book on ZF3            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Subir_archivos_con_formularios/El_contenedor_InputFilter_y_los_archivos_subidos.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Subir_archivos_con_formularios/Ejemplo__Galería_de_Imágenes.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Subir_archivos_con_formularios.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Subir archivos con formularios</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Acción_de_controlador_y_carga_de_archivos">10.7. Acción de controlador y carga de archivos</h2>
<p>En esta sección, con un ejemplo de código breve mostraremos como administrar
la subida de archivo con un método de acción en el controlador. Atraeremos
la atención del lector a los aspectos específicos de la subida de archivos.</p>
<p>Supongamos que queremos agregar una página web que muestre un formulario
(llamémoslo <code>YourForm</code>) capaz de subir archivos. Para esta página, necesitamos
agregar el método <code>uploadAction()</code> a la clase controladora:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
//...
class IndexController extends AbstractActionController
{
    // This is the "upload" action displaying the Upload page.
    public function uploadAction()
    {
        // Create the form model.
        $form = new YourForm();

        // Check if user has submitted the form.
        if($this-&gt;getRequest()-&gt;isPost()) {

            // Make certain to merge the files info!
            $request = $this-&gt;getRequest();
            $data = array_merge_recursive(
                $request-&gt;getPost()-&gt;toArray(),
                $request-&gt;getFiles()-&gt;toArray()
            );

            // Pass data to form.
            $form-&gt;setData($data);

            // Execute file validators.
            if($form-&gt;isValid()) {

                // Execute file filters.
                $data = $form-&gt;getData();

                // Redirect the user to another page.
                return $this-&gt;redirect()-&gt;toRoute('application', ['action'=&gt;'index']);
            }
        }

        // Render the page.
        return new ViewModel([
                 'form' =&gt; $form
            ]);
    }
}
</code></pre>
<p>Como podemos ver en el código de arriba, el método <code>uploadAction()</code> tiene el aspecto
usual de una acción de controlador que implementa el flujo de trabajo típico,
sin embargo el método tiene algunos aspectos específicos para cargar archivos
(estos aspectos se marcan en <strong>negritas</strong>):</p>
<ul>
<li><p>En la línea 9, creamos una instancia del modelo de formulario <code>YourForm</code> con
la ayuda del operador <code>new</code>.</p>
</li>
<li><p>En la línea 12, revisamos si la petición es una petición HTTP POST. Si es así,
<strong>traemos los datos de los arreglos super-globales de PHP <code>$_POST</code> y <code>$_FILES</code>
y los unimos en un solo arreglo (líneas 15-19). Esto es necesario para gestionar
correctamente los archivos subidos. Luego pasamos este arreglo al modelo del
formulario con el método <code>setData()</code> (línea 22)</strong>.</p>
</li>
<li><p>En la línea 25, llamamos al método del modelo de formulario <code>isValid()</code>.
Este método ejecuta el filtro de entradas asociado al modelo de formulario.
Para las entradas de la clase <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/InputFilter/FileInput.html" class="api-link">FileInput</a></code> <strong>solo se ejecutarán los validadores
asociados</strong>.</p>
</li>
<li><p>Si los datos son validos, llamamos al método <code>getData()</code> (línea 28). Para los
campos de la clase <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/InputFilter/FileInput.html" class="api-link">FileInput</a></code>, <strong>este método ejecutará los filtros de archivo
asociados</strong>. Los filtros de archivos, por ejemplo, podrían mover los archivos
subidos a la carpeta de destino.</p>
</li>
<li><p>En caso de éxito, en la línea 31, dirigimos al usuario a la acción «index»
del controlador.</p>
</li>
</ul>
<blockquote class="notquote information" data-type="information"><p> Arriba, en la acción del controlador debemos recordar tres cosas: 1) unir
 los arreglos super-globales <code>$_POST</code> y <code>$_FILES</code> antes de pasarlos
 al método del formulario <code>setData()</code>; 2) usar el método del formulario
 <code>isValid()</code> para revisar la corrección de los archivos subidos (ejecutar
 validadores); 3) usar el método del formulario <code>getData()</code> para ejecutar los
 filtros.</p>
</blockquote>        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Subir_archivos_con_formularios.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Subir archivos con formularios</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Subir_archivos_con_formularios/El_contenedor_InputFilter_y_los_archivos_subidos.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Subir_archivos_con_formularios/Ejemplo__Galería_de_Imágenes.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2018 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

