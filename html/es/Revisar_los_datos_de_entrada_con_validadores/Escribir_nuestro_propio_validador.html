<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book on Zend Framework for beginners">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Escribir nuestro propio validador &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book on Zend Framework for beginners            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Revisar_los_datos_de_entrada_con_validadores/Ejemplos_de_uso_de_validadores.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Revisar_los_datos_de_entrada_con_validadores/Usar_filtros_y_validadores_fuera_del_formulario.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Revisar_los_datos_de_entrada_con_validadores.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Revisar los datos de entrada con validadores</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Escribir_nuestro_propio_validador">9.7. Escribir nuestro propio validador</h2>
<p>Una alternativa al uso del validador <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Validator/Callback.html" class="api-link">Callback</a></code> es escribir nuestra propia clase
validadora, implementando la interfaz <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Validator/ValidatorInterface.html" class="api-link">ValidatorInterface</a></code>. Y luego, este validador
se puede usar en los formulario de nuestra aplicación web.</p>
<p>Para demostrar como crear nuestro propio validador, escribiremos la clase
<code>PhoneValidator</code>, encapsulando el algoritmo de validación que usamos en el ejemplo
del validador <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Validator/Callback.html" class="api-link">Callback</a></code>.</p>
<blockquote class="notquote information" data-type="information"><p> Como podemos recordar, la clase concreta base para todos los validadores
 estándares es la clase <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Validator/AbstractValidator.html" class="api-link">AbstractValidator</a></code>. Por analogía, también derivaremos
 nuestro validador personalizado <code>PhoneValidator</code> de esta clase base.</p>
</blockquote><p>Planeamos tener los siguientes métodos en nuestra clase validadora <code>PhoneValidator</code>
(ver tabla 9.15):</p>
<div class="table-wrapper">
<div class="table-caption">Tabla 9.15. Métodos públicos del validador Callback</div><table>
<thead>
<tr>
<th> <em>Nombre del método</em>            </th>
<th> <em>Descripción</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>__construct($options)</code>                                         </td>
<td>  Constructor. Acepta un argumento opcional, <code>$options</code>, que es   necesario para colocar las opciones del validador.            </td>
</tr>
<tr>
<td> <code>setFormat($format)</code>           </td>
<td> Coloca la opción: formato de número de teléfono.              </td>
</tr>
<tr>
<td> <code>getFormat()</code>                  </td>
<td> Regresa la opción del formato de número de telefónico.        </td>
</tr>
<tr>
<td> <code>isValid($value)</code>                                               </td>
<td> Regresa <code>true</code> cuando el valor es un número de teléfono         valido, de lo contrario regresa <code>false</code>.                      </td>
</tr>
<tr>
<td> <code>getMessages()</code>                                                 </td>
<td> Si la validación falla, el método regresa un arreglo de         mensajes de error.                                            </td>
</tr>
</tbody>
</table>
</div>
<p>Para la clase <code>PhoneValidator</code>, tendremos tres posibles mensajes de error:</p>
<ul>
<li>Si se pasa un valor no escalar al validador, generará el mensaje de error:
«El número de teléfono debe ser un valor escalar».</li>
<li>Si se selecciona el formato de teléfono internacional y el número de teléfono
ingresado no coincide con el formato, el validador generará el mensaje:
«El número de teléfono debe estar en formato internacional».</li>
<li>Si se selecciona el formato de número de teléfono local y el número de teléfono
ingresado no coincide con el formato, el validador generará el mensaje:
«El número de teléfono debe estar en formato local».</li>
</ul>
<p>Para comenzar, creamos el archivo <em>PhoneValidator.php</em> en la carpeta <em>Validator</em>
que está dentro de la carpeta fuente del módulo <sup id="fnref:phone_validator_service"><a href="#fn:phone_validator_service" class="footnote-ref" rel="footnote">38</a></sup>. Colocamos
el siguiente código dentro del archivo:</p>
<footnotes id="fn:phone_validator_service"><p><sup>38)</sup> La clase <code>PhoneValidator</code> se puede considerar como
un modelo de servicio, porque su objetivo es procesar
datos y no guardarlos. Por convención, guardamos el
validador personalizado dentro de la carpeta <code>Validator</code>.</p>
</footnotes>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Validator;

use Zend\Validator\AbstractValidator;

// This validator class is designed for checking a phone number for
// conformance to the local or to the international format.
class PhoneValidator extends AbstractValidator
{
  // Phone format constants.
  const PHONE_FORMAT_LOCAL = 'local'; // Local phone format.
  const PHONE_FORMAT_INTL  = 'intl';  // International phone format.

  // Available validator options.
  protected $options = [
    'format' =&gt; self::PHONE_FORMAT_INTL
  ];

  // Validation failure message IDs.
  const NOT_SCALAR  = 'notScalar';
  const INVALID_FORMAT_INTL  = 'invalidFormatIntl';
  const INVALID_FORMAT_LOCAL = 'invalidFormatLocal';

  // Validation failure messages.
  protected $messageTemplates = [
    self::NOT_SCALAR  =&gt; "The phone number must be a scalar value",
    self::INVALID_FORMAT_INTL =&gt; "The phone number must be in international format",
    self::INVALID_FORMAT_LOCAL =&gt; "The phone number must be in local format",
  ];

  // Constructor.
  public function __construct($options = null)
  {
    // Set filter options (if provided).
    if(is_array($options)) {

      if(isset($options['format']))
        $this-&gt;setFormat($options['format']);
      }

      // Call the parent class constructor.
      parent::__construct($options);
  }

  // Sets phone format.
  public function setFormat($format)
  {
    // Check input argument.
    if($format!=self::PHONE_FORMAT_LOCAL &amp;&amp;
       $format!=self::PHONE_FORMAT_INTL) {
      throw new \Exception('Invalid format argument passed.');
    }

    $this-&gt;options['format'] = $format;
  }

  // Validates a phone number.
  public function isValid($value)
  {
    if(!is_scalar($value)) {
      $this-&gt;error(self::NOT_SCALAR);
      return false; // Phone number must be a scalar.
    }

    // Convert the value to string.
    $value = (string)$value;

    $format = $this-&gt;options['format'];

    // Determine the correct length and pattern of the phone number,
    // depending on the format.
    if($format == self::PHONE_FORMAT_INTL) {
      $correctLength = 16;
      $pattern = '/^\d \(\d{3}\) \d{3}-\d{4}$/';
    } else { // self::PHONE_FORMAT_LOCAL
      $correctLength = 8;
      $pattern = '/^\d{3}-\d{4}$/';
    }

    // First check phone number length
    $isValid = false;
    if(strlen($value)==$correctLength) {
      // Check if the value matches the pattern.
      if(preg_match($pattern, $value))
        $isValid = true;
    }

    // If there was an error, set error message.
    if(!$isValid) {
      if($format==self::PHONE_FORMAT_INTL)
        $this-&gt;error(self::INVALID_FORMAT_INTL);
      else
        $this-&gt;error(self::INVALID_FORMAT_LOCAL);
    }

    // Return validation result.
    return $isValid;
  }
}
</code></pre>
<p>En la línea 2, podemos ver que la clase validadora pertenece al espacio de nombres
<code>Application\Validator</code>.</p>
<p>En la línea 8, definimos la clase <code>PhoneValidator</code>. Derivamos nuestra clase validadora
de la clase base <code>AbstractValidator</code> para reusar la funcionalidad que provee. La
línea 4 contiene el alias para la clase <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Validator/AbstractValidator.html" class="api-link">AbstractValidator</a></code>.</p>
<p>Entre las líneas 11-12, por conveniencia, definimos las constantes para el formato
de número de teléfono (<code>PHONE_FORMAT_INTL</code> para el formato internacional y
<code>PHONE_FORMAT_LOCAL</code> para el formato local). Estas son equivalentes respectivamente
a las cadenas de caracteres «intl» y «local».</p>
<p>En las líneas 15-17, definimos la variable privada <code>$options</code> que es un arreglo
que tiene una sola llave llamada «format». Esta llave contendrá la opción del
formato de número de teléfono para nuestro validador.</p>
<p>En las líneas 20-22, definimos los identificadores de mensajes de error. Tenemos
tres identificadores (<code>NOT_SCALAR</code>, <code>INVALID_FORMAT_INTL</code> e <code>INVALID_FORMAT_LOCAL</code>),
porque nuestro validador puede generar tres diferentes mensajes de error. Estos
identificadores se usan para que la maquina, y no los humanos, distingan los
diferentes mensajes de error.</p>
<p>Entre las líneas 25-29, tenemos la variable de tipo arreglo <code>$messageTemplates</code>
que contiene la asociación entre los identificadores de mensajes de error anteriores
y su representación textual. Los mensajes textuales se mostrarán a los humanos.</p>
<p>En las líneas 32-43, tenemos al método constructor que toma a la variable <code>$options</code>
como único argumento. Cuando construimos el validador manualmente, podemos omitir
este parámetro. Pero, cuando el validador es construido por la clase fábrica,
la fábrica pasará las opciones al constructor del validador a través de este
argumento.</p>
<p>En las líneas 46-55, tenemos el método <code>setFormat()</code> que permite colocar el formato
de teléfono actual.</p>
<p>En las líneas 58-98, tenemos al método <code>isValid()</code>. Este método encapsula el algoritmo
que revisa el número de teléfono. Toma a la variable <code>$value</code> como parámetro,
ejecuta la comparación con la expresión regular y regresa <code>true</code> en caso de éxito.</p>
<p>En caso de falla, el método <code>isValid()</code> regresa el booleano <code>false</code> y la lista de
errores, esta se pueden recuperar con el método <code>getMessages()</code>.</p>
<blockquote class="notquote information" data-type="information"><p> Notemos que no se define el método <code>getMessages()</code> en nuestra clase <code>PhoneValidator</code>.
 Esto es porque heredamos este método de la clase base <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Validator/AbstractValidator.html" class="api-link">AbstractValidator</a></code>.
 Dentro de nuestro método <code>isValid()</code>, para generar mensajes de error, usamos
 el método protegido <code>error()</code> que provee la clase base (líneas 61, 91, 93).</p>
</blockquote><blockquote class="notquote tip" data-type="tip"><p> The <code>PhoneValidator</code> is only for demonstration of how to write custom validators in ZF3. 
 Implementing a validator that will work correctly against all possible phone numbers in 
 the world is beyond the scope of this book. If you'd like to use this validator in a real-life 
 app, you will definitely need to improve it. For example, take a look at the <code>libphonenumber</code> 
 PHP library from Google.</p>
</blockquote><h3 id="Usar_la_clase_PhoneValidator">9.7.1. Usar la clase PhoneValidator</h3>
<p>Cuando la clase validadora <code>PhoneValidator</code> está lista, podemos fácilmente comenzar
a usarla en el formulario de contacto (o en otro formulario) de la siguiente manera.
Se asume que llamamos el siguiente código dentro del método <code>ContactForm::addInputFilter()</code>:</p>
<pre class=""><code class="language-php">$inputFilter-&gt;add([
      'name'     =&gt; 'phone',
      'required' =&gt; true,
      'validators' =&gt; [
        [
          [
            'name' =&gt; PhoneValidator::class,
            'options' =&gt; [
              'format' =&gt; PhoneValidator::PHONE_FORMAT_INTL
            ]
          ],
        ],
        // ...
      ],
      // ...
    ]);
</code></pre>
<p>Podemos ver al validador <code>PhoneValidator</code> funcionando en la aplicación de ejemplo
<em>Form Demo</em> que está disponible junto a este libro. Abrimos la página
«http://localhost/contactus» en nuestro navegador web. Si ingresamos algún número
de teléfono en un formato incorrecto, el validador mostrara un error (ver figura 9.3).</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/validators/phone_number_validation_error.png">
<img src="../../en/images/validators/phone_number_validation_error.png" alt="Figura 9.3. Error de validación de número de teléfono" /></a>
<span class="image-caption">Figura 9.3. Error de validación de número de teléfono</span>
</span>
</p>
<p>Si lo deseamos, podemos usar la clase <code>PhoneValidator</code> fuera de los formularios
como se muestra en el código de ejemplo más abajo:</p>
<pre class=""><code class="language-php">&lt;?php
use Application\Validator\PhoneValidator;

// Create PhoneValidator validator
$validator = new PhoneValidator();

// Configure the validator.
$validator-&gt;setFormat(PhoneValidator::PHONE_FORMAT_INTL);

// Validate a phone number
$isValid = $validator-&gt;isValid('1 (234) 567-8901'); // Returns true.
$isValid2 = $validator-&gt;isValid('12345678901'); // Returns false.

if(!$isValid2) {
  // Get validation errors.
  $errors = $validator-&gt;getMessages();
}
</code></pre>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Revisar_los_datos_de_entrada_con_validadores.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Revisar los datos de entrada con validadores</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Revisar_los_datos_de_entrada_con_validadores/Ejemplos_de_uso_de_validadores.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Revisar_los_datos_de_entrada_con_validadores/Usar_filtros_y_validadores_fuera_del_formulario.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2018 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

