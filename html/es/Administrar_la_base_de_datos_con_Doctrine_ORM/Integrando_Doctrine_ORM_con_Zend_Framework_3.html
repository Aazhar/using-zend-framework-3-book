<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free, read-frendly and open-source book on ZF3">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2019 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Integrando Doctrine ORM con Zend Framework 3 &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free, read-frendly and open-source book on ZF3            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Crear_una_base_de_datos_simple_con_MySQL.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Especificar_los_Parámetros_de_Conexión.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Administrar la base de datos con Doctrine ORM</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Integrando_Doctrine_ORM_con_Zend_Framework_3">12.3. Integrando Doctrine ORM con Zend Framework 3</h2>
<p>Para una fácil integración con Zend Framework 3 el proyecto Doctrine provee los siguientes
componentes (que de hecho son modules de ZF3);</p>
<ul>
<li><p><a target="_blank" href="https://github.com/doctrine/DoctrineORMModule">DoctrineModule</a> es un modulo de ZF3 que
provee la funcionalidad básica de Doctrine que necesita el componente ORM.</p>
</li>
<li><p><a target="_blank" href="https://github.com/doctrine/DoctrineORMModule">DoctrineORMModule</a> integra el Mapeo
objeto-relacional (ORM) de Doctrine con Zend Framework 3.</p>
</li>
</ul>
<p>Cada uno de estos componentes de Doctrine es distribuido como un paquete instalable de Composer
y esta registrado en el catalogo <a target="_blank" href="https://packagist.org/">Packagist.org</a>. Esta es una manera
muy parecida a la que Zend Framework 3 usa para instalar sus componentes.</p>
<p>Como los paquetes de Composer pueden depender de otros paquetes es suficiente declarar la
dependencia sobre <em>DoctrineModule</em>. Este paquete depende de <em>DoctrineModule</em> y de otros
componentes de Doctrine (<em>Doctrine\ORM</em>, <em>Doctrine\DBAL</em>, <em>Doctrine\Common</em>, <em>Doctrine\Annotations</em>, etc.).
Así, cuando se instala aquel componente Composer instalará los otros componentes necesarios automáticamente.</p>
<h3 id="Instalar_el_Componente_Doctrine_Components_con_Composer">12.3.1. Instalar el Componente Doctrine Components con Composer</h3>
<p>Para instalar el componente Doctrine primero <em>agregamos una dependencia</em> al archivo
<em>composer.json</em> ubicado en el directorio raíz de la aplicación web (en este libro
comúnmente nos referimos a este directorio como <em>APP_DIR</em>).</p>
<p>Para agregar la dependencia escribimos las siguientes ordenes en la linea de comandos
(reemplazando <em>APP_DIR</em> por el nombre del directorio de nuestra aplicación):</p>
<p><code>cd APP_DIR</code></p>
<p><code>php composer.phar require doctrine/doctrine-orm-module</code></p>
<p>El comando <code>cd</code> de arriba se usa para hacer al directorio <em>APP_DIR</em> el directorio
de trabajo actual.</p>
<p>El comando <code>require</code> le dice a Composer que agregue el paquete <code>doctrine/doctrine-orm-module</code>
como una dependencia de nuestra aplicación web y que la descargue e instale.</p>
<p>Una vez que ejecutamos los comandos de arriba Composer primero modifica el archivo
<em>composer.json</em> y crea una linea como la de abajo dentro de la llave <code>require</code>:</p>
<pre class=""><code class="language-json">{
  ...
  "require": {
    "doctrine/doctrine-orm-module": "^1.0.9",
    ...
  },
  ...
}
</code></pre>
<p>Luego Composer intentará ubicar el paquete dependiente, descargarlo a nuestra computadora e
instalar los archivos dentro del directorio <em>APP_DIR</em>.</p>
<p>Composer imprimirá algunas lineas en la terminal indicando el proceso de instalación.
Como podemos ver en la salida que genera Composer, cuando instalamos el componente <code>DoctrineORMModule</code>
Composer automáticamente instala <code>DoctrineModule</code> y todos los componentes necesarios
de Doctrine (<em>Doctrine\DBAL\Doctrine\ORM</em>, etc.)</p>
<blockquote class="notquote information" data-type="information"><p> Adicionalmente al terminar la instalación Composer "sugiere" instalar algunos paquetes
 adicionales que pueden ser útiles para nosotros (<code>doctrine/migrations</code>, <code>doctrine/data-fixtures</code>, etc).
 Si queremos podemos agregar estas dependencias de la misma manera que antes usando
 el comando de Composer <code>require</code>.</p>
</blockquote><p>Cuando la instalación termina podemos encontrar los archivos de Doctrine en el
directorio <em>APP_DIR/vendor</em> (ver figura 12.4).</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/doctrine/installed_doctrine_files.png">
<img src="../../en/images/doctrine/installed_doctrine_files.png" alt="Figure 12.4. Los archivo de Doctrine se guardan en el directorio" /></a>
<span class="image-caption">Figure 12.4. Los archivo de Doctrine se guardan en el directorio</span>
</span>
</p>
<blockquote class="notquote tip" data-type="tip"><p> Usamos el comando <code>php composer.phar require</code> para instalar Doctrine por primera vez.
 Una vez que los archivos <em>composer.json</em> y <em>composer.lock</em> son modificados por
 Composer podemos instalar o actualizar todas las dependencias escribiendo los
 comandos <code>php composer.phar install</code> y <code>php composer.phar update</code> respectivamente
 desde la línea de comandos.</p>
</blockquote><h3 id="Cargar_los_Módulos_de_Integración_al_Arrancar_la_Aplicación">12.3.2. Cargar los Módulos de Integración al Arrancar la Aplicación</h3>
<p>Una vez que hemos instalado <em>DoctrineORMModule</em> y todas sus dependencias necesitamos
agregar las siguientes lineas en el archivo <em>APP_DIR/config/modules.config.php</em> para
activar los módulos:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
return [
    // Add the Doctrine integration modules.
    'DoctrineModule',
    'DoctrineORMModule',
    //...
);
</code></pre>
<p>Las lineas de arriba le dicen a ZF3 que debe cargar los módulos <em>DoctrineModule</em>
y <em>DoctrineORMModule</em> al inicio de la aplicación.</p>
<h3 id="Visión_General_de_la_Configuración_de_Doctrine">12.3.3. Visión General de la Configuración de Doctrine</h3>
<p>Para usar Doctrine con nuestra aplicación web basada en ZF3 tenemos que proveer
su configuración. La configuración le dice a Doctrine que base de datos están presentes,
como conectar una base de datos (que base de datos, controlador, servidor, nombre de
usuario y contraseña usar), donde están ubicadas las clases-entidad y como extraer
sus anotaciones (metadata), como guardar la caché de los datos (en el sistema de archivos
o con una extensión), etc. Esta sección pretende dar una idea general de como la
configuración de Doctrine se ve.</p>
<p>La configuración por defecto de Doctrine se ubica en el archivo de configuración
<em>module.config.php</em> de <em>DoctrineORMModule</em>. Podemos ver la figura 12.5 abajo
para tener una idea de como se ve <em>el árbol</em> de configuración de Doctrine <sup id="fnref:doctrine_config"><a href="#fn:doctrine_config" class="footnote-ref" rel="footnote">47</a></sup>.
Además, podemos revisar el archivo <em>module.config.php</em> de <em>DoctrineORMModule</em> y
ver también el árbol de configuración.</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/doctrine/doctrine_config_tree.png">
<img src="../../en/images/doctrine/doctrine_config_tree.png" alt="Figure 12.5. Representación gráfica del *árbol* de configuración de Doctrine" /></a>
<span class="image-caption">Figure 12.5. Representación gráfica del *árbol* de configuración de Doctrine</span>
</span>
</p>
<footnotes id="fn:doctrine_config"><p><sup>47)</sup> El árbol en la figura 12.5 puede ser diferente del que tienes
en tu propia aplicación porque algunas llaves fueron omitidas
aquí por simplicidad.</p>
</footnotes>
<p>Como podemos ver en la figura 12.5 existe una llave de primer nivel llamada <code>doctrine</code>.
Debajo de esta llave hay un numero de sub-llaves que contienen las siguientes configuraciones:</p>
<ul>
<li>La llave <code>connection</code> contiene la lista de todas las bases de datos a las que la
aplicación puede conectarse. Para cada conexión de base de datos hay parámetros
como nombre de la clase controladora (driver), servidor, nombre de usuario, contraseña y
nombre de la base de datos.</li>
</ul>
<blockquote class="notquote information" data-type="information"><p> Por defecto hay solo un nombre de conexión llamado <code>orm_default</code>, podemos agregar
 más conexiones a la base de datos si lo necesitamos.</p>
</blockquote><ul>
<li><p>La llave <code>configuration</code> contiene las configuraciones del ORM, como caché y la
ubicación de las entidades-clase proxy auto-generadas, por cada conexión disponible.</p>
</li>
<li><p>La llave <code>driver</code> contiene la información sobre donde ubicar las clases-entidad
por cada conexión a base de datos disponible.</p>
</li>
<li><p>La llave <code>entitymaneger</code> contiene las configuraciones que se usan para instanciar
un administrador de entidades por cada conexión a base de datos.</p>
</li>
<li><p>La llave <code>eventmanager</code> contiene las configuraciones para el administrador de eventos
de Doctrine por cada conexión disponible.</p>
</li>
</ul>
<blockquote class="notquote information" data-type="information"><p> Doctrine usa su propia implementación del administrador de eventos. Si queremos
 podemos crear una clase listener de evento y enganchar algunos eventos. Sin embargo,
 este un tema avanzado y no es cubierto en este libro.</p>
</blockquote><ul>
<li>La llave <code>migrations_configuration</code> contiene las configuraciones para las migraciones
de base de datos. Las migraciones de base de datos se usan para inicializar y
actualizar el esquema de base de datos de una manera estándar y consistente.</li>
</ul>
<h3 id="Sobrescribir_la_Configuración_por_Defecto_de_Doctrine">12.3.4. Sobrescribir la Configuración por Defecto de Doctrine</h3>
<p>Como ya sabemos a partir del capítulo <a  href="../Operación_del_Sitio_Web.html">Operación del Sitio Web</a> la
configuración de una aplicación web basada en ZF3 se divide generalmente en dos
categorías: configuración general de la aplicación y configuración específica del
modulo.</p>
<ul>
<li><p>Para guardar la configuración general de Doctrine generalmente usamos el archivo
de configuración <em>APP_DIR/config/autoload/global.php</em> o el archivo
<em>APP_DIR/config/autoload/local.php</em>. El primer archivo es adecuado para guardar
configuraciones que no dependen de un entorno particular mientras que el segundo
es adecuado para guardar configuraciones que dependen del entorno (como los
parámetros de conexión a la base de datos).</p>
</li>
<li><p>Para guardar las configuraciones específicas de Doctribe para determinados módulos
usamos el archivo de configuración <em>module.config.php</em> ubicado dentro de la carpeta
<em>config</em> de este módulo. Por ejemplo, este archivo es apropiado para guardar la
configuración de ubicación de las entidades.</p>
</li>
</ul>
<p>Cuando un sitio web basado en ZF3 carga su configuración se mezclan todas las
configuraciones dentro de un solo gran arreglo para formar el "árbol" final de
configuración de Doctrine.</p>
<blockquote class="notquote information" data-type="information"><p> Además, nuestra configuración específica de Doctrine extiende y/o sobrescribe
 el árbol de configuración definido por <em>DoctrineORMModule</em>.</p>
</blockquote>        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Administrar la base de datos con Doctrine ORM</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Crear_una_base_de_datos_simple_con_MySQL.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Especificar_los_Parámetros_de_Conexión.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2019 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

