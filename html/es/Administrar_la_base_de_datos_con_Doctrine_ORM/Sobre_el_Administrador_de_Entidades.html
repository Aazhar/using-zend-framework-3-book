<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book on Zend Framework for beginners">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Sobre el Administrador de Entidades &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book on Zend Framework for beginners            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Crear_Entidades.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Agregar_la_Página_Home_del_Blog.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Administrar la base de datos con Doctrine ORM</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Sobre_el_Administrador_de_Entidades">12.7. Sobre el Administrador de Entidades</h2>
<p>El <em>Administrador de entidades</em> es el punto de acceso primario a la característica de ORM que
provee Doctrine.</p>
<blockquote class="notquote information" data-type="information"><p> El <code>EntityManager</code> es una clase de Doctrine que se encuentra en el namespace
 <code>Doctrine\ORM</code> y se usa para recuperar entidades de nuestros repositorios usando
 un criterio de búsqueda y, además, guarda entidades en la base de datos.</p>
</blockquote><p>El <code>EntityManager</code> se registra como un servicio en el administrador de servicios
de Zend Framework 3. Desde nuestra clase factory recuperamos el <code>EntityManager</code> del
administrador de servicios de la siguiente manera (si necesitamos una conexión
diferente a la <code>orm_default</code>, solamente reemplazamos <code>orm_default</code> con el nombre
de la conexión a la base de datos adecuada):</p>
<pre class=""><code class="language-php">// Get Doctrine entity manager
$entityManager = $container-&gt;get('doctrine.entitymanager.orm_default');
</code></pre>
<p>Los métodos más usados provistos por la clase <code>EntityManager</code> se listan en la tabla
12.4 que se muestra abajo:</p>
<div class="table-wrapper">
<div class="table-caption">Table 12.4. Métodos del EntityManager</div><table>
<thead>
<tr>
<th> <em>Método</em>                           </th>
<th> <em>Descripción</em>                                    </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>persist($entity)</code>                                                      </td>
<td>  Coloca una nueva entidad dentro del administrador  de entidades (se hace manejable).                </td>
</tr>
<tr>
<td> <code>remove($entity)</code>                  </td>
<td> Remueve una entidad de la base de datos.         </td>
</tr>
<tr>
<td> <code>flush()</code>                                                               </td>
<td> Purga todos los cambios del objeto que están en    cola hasta ahora hacia la base de datos.         </td>
</tr>
<tr>
<td> <code>createQuery($dql)</code>                </td>
<td> Crea un nuevo objeto Query.                      </td>
</tr>
<tr>
<td> <code>getRepository($entityName)</code>       </td>
<td> Traer un repositorio para una clase de tipo entidad. </td>
</tr>
</tbody>
</table>
</div>
<p>Vamos a revisar los métodos de la tabla 12.4.</p>
<p>Para agregar una entidad creada recientemente al administrador de entidades (haciendo
a la entidad "administrada") usamos el método <code>persist()</code>. Para remover una entidad
de la base de datos usamos el método <code>remove()</code> del administrador de eventos.</p>
<p>Cuando llamamos a <code>persist()</code> o <code>remove()</code> el <code>EntityManager</code> recuerda nuestros
cambios en memoria pero no aplica los cambios en la base de datos automáticamente
(por razones de rendimiento). Para aplicar los cambios en la base de datos, en una
única transacción, usamos el método <code>flush()</code>.</p>
<p>Por ejemplo, el código de ejemplo de abajo muestra como crear una instancia de la
entidad <code>Post</code> y como guardarla en la base de datos:</p>
<pre class=""><code class="language-php">// Create new Post entity.
$post = new Post();
$post-&gt;setTitle('Top 10+ Books about Zend Framework 3');
$post-&gt;setContent('Post body goes here');
$post-&gt;setStatus(Post::STATUS_PUBLISHED);
$currentDate = date('Y-m-d H:i:s');
$post-&gt;setDateCreated($currentDate);

// Add the entity to entity manager.
$entityManager-&gt;persist($post);

// Apply changes to database.
$entityManager-&gt;flush();
</code></pre>
<p>El método <code>createQuery()</code> del administrador de entidades esta diseñado para crear
una consulta desde un cadena de caracteres DQL. Este regresa un objeto <code>Query</code>.
Luego, se ejecuta la consulta y regresa los resultados (un arreglo de entidades
que concuerda con las condiciones de búsqueda).</p>
<p>El método <code>getRepository()</code> del administrador de entidades esta diseñado para traer
el repositorio a partir del nombre de la clase de tipo entidad. Podemos ver abajo,
por ejemplo, como se trae el repositorio para la entidad <code>Post</code>:</p>
<pre class=""><code class="language-php">$repository = $entityManager-&gt;getRepository(Post::class);
</code></pre>
<h3 id="Repositorios_de_Entidades">12.7.1. Repositorios de Entidades</h3>
<p>Conceptualmente cada clase de tipo entidad tiene su propio repositorio. El repositorio
provee métodos para recuperar entidades de la base de datos. El repositorio puede
ser considerado como la colección de todas las entidades disponibles de determinada
clase. Por ejemplo, existen repositorios para las entidades <code>Post</code>, <code>Comment</code> y
<code>Tag</code>.</p>
<p>Para cargar datos desde la base de datos recuperamos una entidad de su repositorio.
Cuando pedimos el repositorio para una entidad se cargan los datos desde la tabla
asociada a la entidad y se asignan los campos de la entidad a los datos.</p>
<blockquote class="notquote information" data-type="information"><p> La clase <code>Doctrine\ORM\EntityRepository</code> implementa el repositorio por defecto.
 Si lo necesitamos, podemos crear nuestro propio repositorio extendiendo la clase
 <code>EntityRepository</code>. Mostraremos esto más adelante.</p>
</blockquote><p>Los métodos más usado que provee la clase <code>EntityRepository</code> se listan en la tabla
12.5:</p>
<div class="table-wrapper">
<div class="table-caption">Table 12.5. Métodos del EntityRepository</div><table>
<thead>
<tr>
<th> <em>Métodos</em>                          </th>
<th> <em>Descripción</em>                                    </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>findAll()</code>                        </td>
<td>  Busca todas las entidades en el repositorio.     </td>
</tr>
<tr>
<td> <code>find($id)</code>                        </td>
<td> Busca a una entidad a partir de su identificador.</td>
</tr>
<tr>
<td> <code>findBy($criteria, $orderBy, $limit, $offset)</code> </td>
<td> Busca una entidad a partir de un conjunto de criterios. </td>
</tr>
<tr>
<td> <code>findOneBy($criteria, $orderBy)</code>   </td>
<td> Busca una sola entidad a partir de un conjunto de criterios. </td>
</tr>
<tr>
<td> <code>createQueryBuilder($alias)</code>                                            </td>
<td> Crea una nueva instancia del QueryBuilder que es   prepoblada con la entidad.                       </td>
</tr>
</tbody>
</table>
</div>
<p>El método <code>findAll()</code> trae todas las entidades desde el repositorio. Un ejemplo
simple sobre como usarla se muestra abajo:</p>
<pre class=""><code class="language-php">// Find all posts from repository
$posts = $entityManager-&gt;getRepository(Post::class)-&gt;findAll();
</code></pre>
<p>El método <code>find()</code> es el método más simple para buscar una entidad. Este recupera
una entidad a partir de su ID (llave primaria).</p>
<p>En el ejemplo de abajo seleccionamos la publicación con ID = 1.</p>
<pre class=""><code class="language-php">// Find post by primary key (ID)
$post = $entityManager-&gt;getRepository(Post::class)-&gt;find(1);
</code></pre>
<p>El método <code>findBy()</code> toma un argumento como criterio de búsqueda (y opcionalmente
uno de ordenamiento y un límite) y regresa una colección de entidades que coinciden
con el criterio. El método <code>findOneBy()</code> es muy similar al método <code>findBy()</code>,
pero este solo regresa la primera entidad que se ajusta al criterio de búsqueda.</p>
<p>En el código de abajo usamos el método <code>findBy()</code> para seleccionar las 50 publicaciones
publicadas más recientes:</p>
<pre class=""><code class="language-php">// Find 50 most recent published posts
$posts = $entityManager-&gt;getRepository(Post::class)-&gt;findBy(
           ['status'=&gt;Post::STATUS_PUBLISHED],
           ['dateCreated'=&gt;'DESC'], 50);
</code></pre>
<p>Para nuestra conveniencia la clase <code>EntityRepository</code> provee además métodos mágicos
que nos permiten consultar entidades mediante el nombre del atributo, es decir,
con los métodos <code>findByX</code> y <code>FindOneByX</code> (donde X debe reemplazarse con el nombre
del atributo):</p>
<pre class=""><code class="language-php">// Query a single post by ID attribute
$post = $entityManager-&gt;getRepository(Post::class)-&gt;findOneById(1);

// Query posts by status attribute
$posts = $entityManager-&gt;getRepository(Post::class)
        -&gt;findByStatus(Post::STATUS_PUBLISHED);
</code></pre>
<p>Y el método de búsqueda más complejo es <code>createQueryBuilder()</code>. Este método permite
crear consultas DQL complejas.</p>
<p>Si los métodos estándar no son suficientes (o si tenemos criterios de búsqueda complejos
y consultas DQL) podemos crear nuestro propio repositorio extendiendo la clase
estándar <code>EntityRepository</code> y encapsular la lógica de la búsqueda allí. Mostraremos
como hacer esto luego cuando implementemos la característica tag cloud para nuestro
<em>Blog</em> de ejemplo.</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Administrar la base de datos con Doctrine ORM</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Crear_Entidades.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Administrar_la_base_de_datos_con_Doctrine_ORM/Agregar_la_Página_Home_del_Blog.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2018 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

