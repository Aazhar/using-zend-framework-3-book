<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book on ZF3 for beginners">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2019 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Tipos de Ruta Regex &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book on ZF3 for beginners            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Routing/Tipo_de_Ruta_Segment.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Routing/Otros_Tipos_de_Ruta.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Routing.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Routing</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Tipos_de_Ruta_Regex">5.7. Tipos de Ruta Regex</h2>
<p>El tipo de ruta con expresiones regulares (<em>Regex</em>) es útil si tenemos URLs que
se pueden comparar contra una expresión regular.</p>
<p>Por ejemplo, asumiendo que queremos crear un sistema simple de documentación para
nuestro sitio web. La documentación consistiría en páginas "estáticas" que se hacen
corresponder con URLs del tipo <em>/doc/&lt;page_name&gt;.html</em>.</p>
<blockquote class="notquote information" data-type="information"><p> Con el termino "página estática" nos referimos a una página que contiene principalmente
 código HTML estático más varios fragmentos de código PHP en linea. Para cada
 página simple no necesitamos crear acciones separadas en el controlador. Todas las
 páginas "estáticas" se pueden servir con una sola de acción en el controlador.</p>
</blockquote><p>Vamos a implementar la ruta que servirá las páginas "estáticas" del sitio. Como
las páginas "estáticas" son simples, generalmente no necesitamos agregar un método
de acción por página en el controlador. Todas las páginas serán manejadas por una
sola acción: <code>IndexController::docAction()</code>.</p>
<p>Primero, agregamos la ruta <em>Regex</em> llamada "doc" en el archivo <em>module.config.php</em>:</p>
<pre class="line-numbers"><code class="language-php">'doc' =&gt; [
    'type' =&gt; Regex::class,
    'options' =&gt; [
        'regex'    =&gt; '/doc(?&lt;page&gt;\/[a-zA-Z0-9_\-]+)\.html',
        'defaults' =&gt; [
            'controller' =&gt; Controller\IndexController::class,
            'action'     =&gt; 'doc',
        ],
        'spec'=&gt;'/doc/%page%.html'
    ],
],
</code></pre>
<p>La línea 2 define el tipo de ruta como <em>Regex</em>. En la línea 4 tenemos le expresión
regular <code>/doc(?&lt;page&gt;\/[a-zA-Z0-9_\-]+)\.html</code>. Estas coincidirán con URLs como
"/doc/contents.html", "/doc/introduction.html", etc. La expresión contiene una
captura <sup id="fnref:capture"><a href="#fn:capture" class="footnote-ref" rel="footnote">6</a></sup> llamada "page" que será regresada por la ruta encontrada
junto con los parámetros por defecto .</p>
<p>La linea 9 contiene la opción <code>spec</code> que es usada por la ruta para generar URLs
(hablaremos sobre la generación de URLs por la ruta luego en este capítulo).</p>
<footnotes id="fn:capture"><p><sup>6)</sup> Con las expresiones regulares de PHP PCRE es posible nombrar un sub-patrón
usando la sintaxis <code>(?P&lt;name&gt;pattern)</code>. Este sub-patrón se indexará
en el arreglo de <em>comparación</em> por su nombre.</p>
</footnotes>
<blockquote class="notquote information" data-type="information"><p> No olvidemos agregar la siguiente línea al comienzo del archivo <code>module.config.php</code>:</p>
<p> <code>user Zend\Router\Http\Regex;</code></p>
</blockquote><p>Luego, agregamos la siguiente acción a la clase <code>IndexController</code>:</p>
<pre class="line-numbers"><code class="language-php">public function docAction()
{
    $pageTemplate = 'application/index/doc'.
        $this-&gt;params()-&gt;fromRoute('page', 'documentation.phtml');

    $filePath = __DIR__.'/../../view/'.$pageTemplate.'.phtml';
    if(!file_exists($filePath) || !is_readable($filePath)) {
        $this-&gt;getResponse()-&gt;setStatusCode(404);
        return;
    }

    $viewModel = new ViewModel([
            'page'=&gt;$pageTemplate
        ]);
    $viewModel-&gt;setTemplate($pageTemplate);

    return $viewModel;
}
</code></pre>
<p>En las líneas 3-4 de arriba recuperamos el parámetro <code>page</code> de la ruta (¿recuerdas
la captura llamada "page" de nuestra expresión regular?) y la guardamos en la variable
<code>$pageTemplate</code>. Usaremos la variable <code>$pageTemplate</code> para determinar el nombre del
plantilla de la vista que se pasará al view resolver. Luego, en las líneas 6-10 revisamos
si el archivo existe y si no regresamos el código de estado 404 "Not Found" que
forzará que ZF3 muestre la página de error. En la línea 12 creamos el contenedor
de la variable <code>ViewModel</code> y en la línea 15 colocamos el nombre del plantilla de la
vista que se mostrará.</p>
<p>Para ver el sistema de documentación en acción creamos un par de plantillas "estáticas":
la página para la Tabla de Contenidos (<code>contents.phtml</code>) y la página de Introducción
(<code>introduction.phtml</code>). Creamos la subcarpeta <em>doc</em> debajo de la carpeta
<em>view/application/index</em> del modulo <code>Application</code> y colocamos la plantilla de vista
<em>contents.phtml</em> ahí:</p>
<pre class=""><code class="language-php">&lt;h1&gt;Table of Contents&lt;/h1&gt;

&lt;ul&gt;
    &lt;li&gt;
        &lt;a href="&lt;?= $this-&gt;url('doc', ['page'=&gt;'introduction']); ?&gt;"&gt;
            Introduction
        &lt;/a&gt;
    &lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>En las líneas de arriba escribimos el código HTML para la cabecera de la página
de la "Tabla de Contenidos" y una lista que contiene un solo elemento llamado "Introduction"
apuntando a la página "estática" Introduction. El enlace URL se genera con el
ayudante de vista <code>Url</code> (para más detalles obre el ayudante <code>Url</code> podemos ver
las siguientes secciones de este capítulo).</p>
<p>Luego agregamos la página <em>introduction.phtml</em> dentro de la misma carpeta <em>doc</em>:</p>
<pre class=""><code class="language-php">&lt;h1&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Some introductory materials.&lt;/p&gt;
</code></pre>
<p>En las líneas de arriba definimos las etiquetas HTML para una página de Introducción
simple.</p>
<p>Ahora, si abrimos la URL "http://localhost/doc/contents.html" en nuestro navegador,
podremos ver un sistema bueno y simple de documentación que podemos extender y usar
en nuestro sitio web (figura 5.8):</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/routing/static_page.png">
<img src="../../en/images/routing/static_page.png" alt="Figure 5.8. Página &quot;estática&quot;" /></a>
<span class="image-caption">Figure 5.8. Página &quot;estática&quot;</span>
</span>
</p>
<p>Haciendo click en el enlace <em>Introduction</em> iremos a la página estática "Introduction".
Además, podemos agregar otras páginas al directorio <em>doc</em> haciendo que estén automáticamente
disponibles para los usuarios del sitio web a través de nuestra ruta <em>Regex</em>.</p>
<blockquote class="notquote information" data-type="information"><p> Una de las desventajas de este sistema de documentación es que no funciona bien
 si anidamos páginas colocándolas en subcarpetas debajo de la carpeta <em>doc</em>.
 La razón de esta limitación recae en la manera en que la ruta <em>Regex</em> construye
 URLs. No podemos construir rutas que contienen caracteres barra, como esta es
 un carácter "inseguro" la URL se codificará automáticamente. Sortearemos este
 problema con el tipo de ruta custom que crearemos al final de este capítulo.</p>
</blockquote>        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Routing.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Routing</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Routing/Tipo_de_Ruta_Segment.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Routing/Otros_Tipos_de_Ruta.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2019 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

