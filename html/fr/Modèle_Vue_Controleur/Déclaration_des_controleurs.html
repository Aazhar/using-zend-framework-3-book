<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free, read-frendly and open-source book on ZF3">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2019 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Déclaration des controleurs &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free, read-frendly and open-source book on ZF3            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Modèle_Vue_Controleur/Afficher_les_erreurs.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modèle_Vue_Controleur/Quand_créer_un_nouveau_contrôleur__.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Modèle_Vue_Controleur.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modèle-Vue-Controleur</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Déclaration_des_controleurs">4.9. Déclaration des controleurs</h2>
<p>Toutes les classes contrôleurs appartenant à un module doivent être déclarées dans le fichier de configuration spécifique, le 
fichier module.config.php. Si votre contrôleur ne dépend pas de services spécifique (il n'a pas de dépendances), vous pouvez 
le déclarer comme celà :</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
use Zend\ServiceManager\Factory\InvokableFactory;

return [
    // ...
    
    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\IndexController::class =&gt; InvokableFactory::class
            // Déclarez les autres contrôleurs ici
        ],
    ],
    
    // ...
];
</code></pre>
<p>Ligne 7, nous pouvons voir la clé controllers, elle contient en sous-clé des factories. 
Pour déclarer un contrôleur, ajoutez une ligne au format clé =&gt; valeur. 
La clé doit être le nom complet de la classe du contrôleur, comme <code>\Application\Controller\IndexController</code> (nous pouvons utiliser 
le mot-clé PHP ::class pour la résolution de son nom). La valeur doit correspondre au nom de la classe factory qui génère le 
contrôleur. 
Dans notre cas, nous utilisons la norme InvokableFactory, mais vous pouvez créer une classe factory spécifique si vous en avez besoin.</p>
<blockquote class="notquote information" data-type="information"><p> En utilisant la classe InvokableFactory, vous indiquez à Zend Framework qu'il peut instancier le contrôleur avec un nouvel 
 opérateur. 
 C'est la manière la plus simple d'instancier un contrôleur. Vous pouvez également déclarer votre propre classe factory pour créer 
 une instance du contrôleur et y injecter des dépendances.</p>
</blockquote><h3 id="Déclaration_d_un_Controller_Factory">4.9.1. Déclaration d'un Controller Factory</h3>
<p>Si votre classe de contrôleur doit appeler un service (cela arrive très souvent), vous devez demander 
ce service au <em>service manager</em> (voir le chapitre <a  href="../Fonctionnement_d_un_site.html">Operation du site</a>) et le passer au constructeur du contrôleur, 
ensuite le contrôleur déclare le service que vous avez passé dans une propriété privée pour un usage interne (également 
appelé injection de dépendance).</p>
<p>Cette procédure est généralement implémentée dans une classe factory. Par exemple, supposons que notre classe de 
contrôleur doit utiliser un service <code>CurrencyConverter</code> qui convertira de l'argent en USD en EUR. La classe 
factory de notre contrôleur ressemblera à ci-dessous:</p>
<pre class=""><code class="language-php">&lt;?php 
namespace Application\Controller\Factory;

use Zend\ServiceManager\Factory\FactoryInterface;
use Application\Service\CurrencyConverter;
use Application\Controller\IndexController;

// Factory class
class IndexControllerFactory implements FactoryInterface
{
    public function __invoke(ContainerInterface $container, 
                     $requestedName, array $options = null) 
    {
        // Obtention de l'instance du service CurrencyConverter auprès du service manager.
        $currencyConverter = $container-&gt;get(CurrencyConverter::class);
        
        // Création d'une instance du contrôleur et transmission de la dépendance au constructeur du contrôleur.
        return new IndexController($currencyConverter);	
    }
}
</code></pre>
<p>Ensuite, vous déclarez le contrôleur de la même manière, mais spécifiez la classe factory que nous venons d'écrire:</p>
<pre class=""><code class="language-php">&lt;?php
return [
    // ...
    
    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\IndexController::class =&gt; Controller\Factory\IndexControllerFactory::class
        ],
    ],
    
    // ...
];
</code></pre>
<blockquote class="notquote information" data-type="information"><p> Si vous connaissez Zend Framework 2, vous remarquerez peut-être que les choses sont maintenant un peu différentes. 
 Dans ZF2, il y avait la méthode getServiceLocator() dans la classe de base  <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/AbstractActionController.html" class="api-link">AbstractActionController</a></code> 
 qui permettait d'obtenir les dépendances du contrôleur sans l'utilisation de classe factory. 
 Dans ZF3, vous devez transmettre les dépendances explicitement. C'est un peu plus galère, mais cela évite les dépendances "cachées" 
 et rend votre code plus clair et plus facile à comprendre.</p>
</blockquote><h3 id="LazyControllerAbstractFactory">4.9.2. LazyControllerAbstractFactory</h3>
<p>L'écriture d'une classe factory pour presque tous les contrôleurs peut sembler ennuyeux à première vue. 
Si vous êtes paresseux et que vous ne voulez pas le faire, vous pouvez utiliser la classe factory <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/LazyControllerAbstractFactory.html" class="api-link">LazyControllerAbstractFactory</a></code>.</p>
<p>Cette classe factory <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/LazyControllerAbstractFactory.html" class="api-link">LazyControllerAbstractFactory</a></code> utilise <em>reflexion</em> pour déterminer les services dont votre contrôleur a 
besoin. Vous n'avez qu'à <em>saisir</em> les arguments du constructeur du contrôleur, et la classe factory récupérera elle-même les services 
demandé pour les transmettre au constructeur.</p>
<p>Par exemple, pour injecter le service <code>CurrencyConverter</code> dans votre contrôleur, assurez-vous que son constructeur ressemble à :</p>
<pre class=""><code class="language-php">namespace Application\Controller;

use Application\Service\CurrencyConverter;

class IndexController extends AbstractActionController
{
    // Ici, nous allons déclarer le service pour un usage interne.
    private $currencyConverter;
    
    // Saisissez les arguments du constructeur pour obtenir les dépendances.
    public function __construct(CurrencyConverter $currencyConverter)
    {
        $this-&gt;currencyConverter = $currencyConverter;
    }
}
</code></pre>
<p>Ensuite, vous déclarez le contrôleur de la même manière, mais spécifiez la classe factory <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/LazyControllerAbstractFactory.html" class="api-link">LazyControllerAbstractFactory</a></code> :</p>
<pre class=""><code class="language-php">&lt;?php
use Zend\Mvc\Controller\LazyControllerAbstractFactory;

return [
    // ...
    
    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\IndexController::class =&gt; LazyControllerAbstractFactory::class
        ],
    ],
    
    // ...
];
</code></pre>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Modèle_Vue_Controleur.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modèle-Vue-Controleur</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Modèle_Vue_Controleur/Afficher_les_erreurs.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modèle_Vue_Controleur/Quand_créer_un_nouveau_contrôleur__.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2019 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

