<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free, read-frendly and open-source book on ZF3">
<meta name="keywords" content="zend framework,book,beginner,free">
<meta name="author" content="2019 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Segment Route Type &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free, read-frendly and open-source book on ZF3            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Routing/Literal_Route_Type.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Routing/Regex_Route_Type.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Routing.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Routing</span>
        </a>
    </div>
    </div>

ï»¿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">

<h2 id="Segment_Route_Type">5.6. Segment Route Type</h2>
<p>The <em>Segment</em> route type allows for matching the route string against one 
or several URL path segments. </p>
<blockquote class="notquote information" data-type="information"><p> If you look at the <em>module.config.php</em> file, you can see the <em>Segment</em> route type is 
 used inside of the "application" route to make actions of your <code>IndexController</code>
 automatically mapped to site URLs. You just add an action method to your <code>IndexController</code> class, 
 and it becomes available by a URL like "http://localhost/application/&lt;action&gt;".
 For example, you can see the <em>About</em> page of your site with the following URL: 
 "http://localhost/application/about".</p>
</blockquote><p>To demonstrate the creation of the <em>Segment</em> route type, let's implement 
a controller action which will generate a simple barcode image.
Barcodes are widely used in supermarkets for optically recognizing goods in your
shopping cart. The barcodes may be of different types and have different 
labels. We will use the <em>Segment</em> route type to map the action to a URL like 
"http://localhost/barcode/&lt;type&gt;/&lt;label&gt;". </p>
<blockquote class="notquote information" data-type="information"><p> To be able to use barcodes, you need to install the <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/components/zendframework/zend-barcode.html" class="api-link">Zend\Barcode</a></code> component with Composer, by
 typing the following command:</p>
<p> <code>php composer.phar require zendframework/zend-barcode</code></p>
</blockquote><blockquote class="notquote warning" data-type="warning"><p> Please note that for barcode images to work, you need to have the GD<sup id="fnref:gd"><a href="#fn:gd" class="footnote-ref" rel="footnote">5</a></sup> extension
 of the PHP engine installed and enabled. In Linux Ubuntu, you can install this extension with the
 following command:</p>
<p> <code>sudo apt-get install php-gd</code></p>
<p> After installing the extension, restart Apache to apply your changes.</p>
</blockquote><footnotes id="fn:gd"><p><sup>5)</sup> PHP GD extension allows to create image files in different formats (like JPEG, PNG, GIF, etc.)</p>
</footnotes>
<p>First, we define the "barcode" route in the <em>module.config.php</em> file:</p>
<pre class="line-numbers"><code class="language-php">'barcode' =&gt; [
    'type' =&gt; Segment::class,
    'options' =&gt; [
        'route' =&gt; '/barcode[/:type/:label]',
        'constraints' =&gt; [     
            'type' =&gt; '[a-zA-Z][a-zA-Z0-9_-]*',
            'label' =&gt; '[a-zA-Z0-9_-]*'
        ],
        'defaults' =&gt; [
            'controller' =&gt; Controller\IndexController::class,
            'action' =&gt; 'barcode',
        ],
    ],
],
</code></pre>
<p>Segments of the route string (line 4) may be constant or variable. You can define the variable
segments by using "wildcards". We have three segments: <code>barcode</code>, <code>:type</code> and <code>:label</code>. 
The <code>barcode</code> segment is constant, while the latter two are wildcards (wildcard's name
should start with a colon).</p>
<p>You specify how a wildcard should look like inside of the <code>constraints</code> subkey (lines 5-8).
We define the regular expression <code>[a-zA-Z][a-zA-Z0-9_-]*</code> which constraints our <code>:type</code> 
wildcard to begin with a letter and (optionally) contain several letters, digits, 
underscores or minus characters. The constraint for the <code>:label</code> wildcard is almost the same, 
but this segment can start with any allowed character (either letter, digit, underscore or minus sign character).</p>
<p>Optional segments can be enclosed in square brackets. In our example, we
have both the <code>:type</code> and <code>:label</code> segments as optional.</p>
<p>In lines 9-12, we define the <code>defaults</code>, the parameters that will be returned by the router.
The <code>controller</code> and <code>action</code> defaults specify which controller and action method to
execute on route match. </p>
<p>Next, we add the <code>barcodeAction()</code> method into the <code>IndexController</code> class:</p>
<pre class="line-numbers"><code class="language-php">// Add name alias in the beginning of the file
use Zend\Barcode\Barcode;

// ...

// The "barcode" action
public function barcodeAction() 
{
  // Get parameters from route.
    $type = $this-&gt;params()-&gt;fromRoute('type', 'code39');
    $label = $this-&gt;params()-&gt;fromRoute('label', 'HELLO-WORLD');
        
    // Set barcode options.
    $barcodeOptions = ['text' =&gt; $label];        
    $rendererOptions = [];
        
    // Create barcode object
    $barcode = Barcode::factory($type, 'image', 
                 $barcodeOptions, $rendererOptions);
        
    // The line below will output barcode image to standard 
    // output stream.
    $barcode-&gt;render();

    // Return Response object to disable default view rendering. 
    return $this-&gt;getResponse();
}  
</code></pre>
<p>In lines 10-11 we get the values of the <code>type</code> and <code>label</code> wildcards
from route. We do that with the help of <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/Plugin/Params.html" class="api-link">Params</a></code> controller plugin's 
<code>fromRoute()</code> method. Analogous to <code>fromQuery()</code> method, it takes
two arguments: the variable name and its default value.</p>
<p>For generating the barcode image, we use the <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/components/zendframework/zend-barcode.html" class="api-link">Zend\Barcode</a></code> component.
In line 14 we define the label text for the barcode. In lines 18-19 we
create the <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Barcode/Barcode.html" class="api-link">Barcode</a></code> object with the factory method. Finally, in line 23 we
render the image file by dumping it to PHP output stream.</p>
<blockquote class="notquote information" data-type="information"><p> <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/components/zendframework/zend-barcode.html" class="api-link">Zend\Barcode</a></code> is an auxiliary component used for generation of various
 barcode images. For additional information about this component, please
 refer to the corresponding section of Zend Framework reference manual.</p>
</blockquote><p>In line 26 we return the <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Http/PhpEnvironment/Response.html" class="api-link">Response</a></code> object to suppress the default view rendering.</p>
<p>Now, enter the "http://localhost/barcode" URL into your browser to see
the barcode image (shown in figure 5.6):</p>
<p><span class="image-wrapper">
<a target="_blank" href="../images/routing/barcode.png">
<img src="../images/routing/barcode.png" alt="Figure 5.6. An example barcode image" /></a>
<span class="image-caption">Figure 5.6. An example barcode image</span>
</span>
</p>
<p>Because we have the wildcards in the route, you can pass the type and label 
parameters of the barcode image in the URL. Below, several
URL examples are provided (corresponding barcodes are presented in figure
5.7):</p>
<pre class=""><code class="language-text">a. http://localhost/barcode/code39/HELLO-WORLD
b. http://localhost/barcode/leitcode/12345
c. http://localhost/barcode/identcode/98765453212
d. http://localhost/barcode/postnet/123456
e. http://localhost/barcode/planet/1234567890123
f. http://localhost/barcode/upca/12345678901
g. http://localhost/barcode/code128/ABCDEF
h. http://localhost/barcode/ean2/12
</code></pre>
<p><span class="image-wrapper">
<a target="_blank" href="../images/routing/barcodes.png">
<img src="../images/routing/barcodes.png" alt="Figure 5.7. Barcode types" /></a>
<span class="image-caption">Figure 5.7. Barcode types</span>
</span>
</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
ï»¿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Routing.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Routing</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Routing/Literal_Route_Type.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Routing/Regex_Route_Type.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright &copy; 2019 by Oleg Krivtsov            </div>
            <div class="footer-menu">
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/terms-and-conditions.html">Terms &amp; Conditions</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/copyright-policy.html">Copyright Policy</a>
                </div>
                                <div class="footer-link">
                    <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/legal/privacy-policy.html">Privacy Policy</a>
                </div>
                            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

